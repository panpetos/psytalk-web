<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Регистрация - psytalk.pro</title>
  <link rel="stylesheet" href="/css/styles.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body style="background-color: #FAFAFA;">
  <!-- Navigation -->
  <nav class="nav" style="background-color: white; border-bottom: 1px solid #F0F0F0;">
    <div class="container">
      <div class="nav-container">
        <a href="/" class="nav-brand" data-testid="link-home" style="font-size: 1.25rem; font-weight: 600; word-spacing: 0; letter-spacing: 0;">
          <span style="color: #1A1A1A;">psy</span><!--
       --><span style="color: #7C3AED; font-style: italic;">talk.pro</span>
        </a>
        
        <button class="burger-menu" id="burgerMenu" data-testid="button-burger-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
        
        <ul class="nav-menu" id="navMenu">
          <li><a href="/#services" class="nav-link" data-testid="link-services">услуги</a></li>
          <li><a href="/search.html" class="nav-link" data-testid="link-psychologists">психологи</a></li>
          <li><a href="/blog.html" class="nav-link" data-testid="link-blog">блог</a></li>
          <li><a href="/offers.html" class="nav-link" data-testid="link-offers">спец. предложения</a></li>
          <li style="margin-left: 2rem;"><a href="/login.html" class="btn btn-ghost btn-sm" data-testid="button-login">Войти</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="section" style="padding: 3rem 0;">
    <div class="container" style="max-width: 500px;">
      <div class="card" style="background-color: white; padding: 2.5rem;">
        <!-- Header -->
        <div class="text-center mb-6">
          <h1 class="font-bold mb-2" style="font-size: 1.75rem; color: #1A1A1A;">
            Создать аккаунт
          </h1>
          <p style="color: #666;">
            Присоединяйтесь к psytalk.pro
          </p>
        </div>

        <!-- Alert -->
        <div id="alert" class="alert" style="display: none; margin-bottom: 1.5rem;"></div>

        <!-- Registration Form -->
        <form id="register-form">
          <!-- User Type Selection -->
          <div class="form-group">
            <label class="form-label">Я хочу зарегистрироваться как:</label>
            <div class="flex gap-3 auth-buttons">
              <label class="flex-1" style="cursor: pointer;">
                <input 
                  type="radio" 
                  name="role" 
                  value="client" 
                  checked 
                  style="display: none;"
                  data-testid="radio-client"
                />
                <div class="role-option active" data-role="client" style="padding: 1rem; border: 2px solid #7C3AED; border-radius: 0.5rem; text-align: center; transition: all 0.2s; background: #F3E8FF;">
                  <i data-lucide="user" style="width: 2rem; height: 2rem; margin: 0 auto 0.5rem; color: #7C3AED;"></i>
                  <div style="font-weight: 600; color: #7C3AED;">Клиент</div>
                </div>
              </label>
              <label class="flex-1" style="cursor: pointer;">
                <input 
                  type="radio" 
                  name="role" 
                  value="psychologist" 
                  style="display: none;"
                  data-testid="radio-psychologist"
                />
                <div class="role-option" data-role="psychologist" style="padding: 1rem; border: 2px solid #E5E5E5; border-radius: 0.5rem; text-align: center; transition: all 0.2s; background: white;">
                  <i data-lucide="brain" style="width: 2rem; height: 2rem; margin: 0 auto 0.5rem; color: #999;"></i>
                  <div style="font-weight: 600; color: #666;">Психолог</div>
                </div>
              </label>
            </div>
          </div>

          <!-- First Name -->
          <div class="form-group">
            <label class="form-label" for="firstName">Имя</label>
            <input 
              type="text" 
              id="firstName" 
              name="firstName" 
              class="form-input" 
              required 
              placeholder="Введите ваше имя"
              data-testid="input-firstName"
            />
          </div>

          <!-- Last Name -->
          <div class="form-group">
            <label class="form-label" for="lastName">Фамилия</label>
            <input 
              type="text" 
              id="lastName" 
              name="lastName" 
              class="form-input" 
              required 
              placeholder="Введите вашу фамилию"
              data-testid="input-lastName"
            />
          </div>

          <!-- Email -->
          <div class="form-group">
            <label class="form-label" for="email">Email</label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              class="form-input" 
              required 
              placeholder="your@email.com"
              data-testid="input-email"
            />
          </div>

          <!-- Password -->
          <div class="form-group">
            <label class="form-label" for="password">Пароль</label>
            <input 
              type="password" 
              id="password" 
              name="password" 
              class="form-input" 
              required 
              placeholder="Минимум 6 символов"
              minlength="6"
              data-testid="input-password"
            />
          </div>

          <!-- Terms -->
          <div class="form-group">
            <label class="flex items-start gap-2" style="cursor: pointer;">
              <input 
                type="checkbox" 
                id="terms" 
                required 
                style="margin-top: 0.25rem;"
                data-testid="checkbox-terms"
              />
              <span style="font-size: 0.875rem; color: #666;">
                Я согласен с 
                <a href="#" style="color: #7C3AED; text-decoration: underline;">условиями использования</a> 
                и 
                <a href="#" style="color: #7C3AED; text-decoration: underline;">политикой конфиденциальности</a>
              </span>
            </label>
          </div>

          <!-- Submit Button -->
          <button 
            type="submit" 
            class="btn w-full btn-lg" 
            id="submit-btn"
            style="background: #7C3AED; color: white; border: none; transition: all 0.2s ease;" 
            onmouseover="this.style.background='#6D28D9'" 
            onmouseout="this.style.background='#7C3AED'"
            data-testid="button-register"
          >
            Зарегистрироваться
          </button>

          <!-- Login Link -->
          <div class="text-center mt-4">
            <span style="color: #666; font-size: 0.875rem;">
              Уже есть аккаунт? 
              <a href="/login.html" style="color: #7C3AED; font-weight: 600; text-decoration: none;" data-testid="link-login">
                Войти
              </a>
            </span>
          </div>
        </form>
      </div>

      <!-- Additional Info -->
      <div class="text-center mt-4" style="color: #999; font-size: 0.875rem;">
        Регистрируясь, вы получаете доступ к нашей платформе психологической поддержки
      </div>
    </div>
  </div>

  <script src="/js/api.js"></script>
  <script>
    // Role selection
    document.querySelectorAll('.role-option').forEach(option => {
      option.addEventListener('click', function() {
        const role = this.dataset.role;
        
        // Update radio
        document.querySelector(`input[value="${role}"]`).checked = true;
        
        // Update styles
        document.querySelectorAll('.role-option').forEach(opt => {
          opt.classList.remove('active');
          opt.style.borderColor = '#E5E5E5';
          opt.style.background = 'white';
          const icon = opt.querySelector('i');
          const text = opt.querySelector('div');
          if (icon) icon.style.color = '#999';
          if (text) text.style.color = '#666';
        });
        
        this.classList.add('active');
        this.style.borderColor = '#7C3AED';
        this.style.background = '#F3E8FF';
        const icon = this.querySelector('i');
        const text = this.querySelector('div');
        if (icon) icon.style.color = '#7C3AED';
        if (text) text.style.color = '#7C3AED';
      });
    });

    // Form submission
    document.getElementById('register-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submit-btn');
      const alert = document.getElementById('alert');
      
      // Get form data
      const formData = new FormData(e.target);
      const data = {
        email: formData.get('email'),
        password: formData.get('password'),
        firstName: formData.get('firstName'),
        lastName: formData.get('lastName'),
        role: formData.get('role')
      };
      
      // Disable button
      submitBtn.disabled = true;
      submitBtn.textContent = 'Регистрация...';
      alert.style.display = 'none';
      
      try {
        const response = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          alert.className = 'alert alert-success';
          alert.textContent = 'Регистрация успешна! Перенаправление...';
          alert.style.display = 'block';
          
          setTimeout(() => {
            if (data.role === 'psychologist') {
              window.location.href = '/psychologist-dashboard.html';
            } else {
              window.location.href = '/client-dashboard.html';
            }
          }, 1500);
        } else {
          const error = await response.json();
          alert.className = 'alert alert-error';
          alert.textContent = error.message || 'Ошибка регистрации';
          alert.style.display = 'block';
          submitBtn.disabled = false;
          submitBtn.textContent = 'Зарегистрироваться';
        }
      } catch (error) {
        console.error('Registration error:', error);
        alert.className = 'alert alert-error';
        alert.textContent = 'Сервер недоступен (DEMO режим). Попробуйте позже.';
        alert.style.display = 'block';
        submitBtn.disabled = false;
        submitBtn.textContent = 'Зарегистрироваться';
      }
    });

    // Check for role in URL
    const urlParams = new URLSearchParams(window.location.search);
    const roleParam = urlParams.get('type');
    if (roleParam === 'psychologist') {
      document.querySelector('input[value="psychologist"]').click();
    }

    // Initialize Lucide icons
    lucide.createIcons();
    
    // Mobile menu functionality
    const navMenu = document.getElementById('navMenu');
    const burgerMenu = document.getElementById('burgerMenu');
    
    if (navMenu && burgerMenu) {
      // Toggle menu on burger click
      burgerMenu.addEventListener('click', function(e) {
        e.stopPropagation();
        navMenu.classList.toggle('active');
        burgerMenu.classList.toggle('active');
        
        // Prevent body scroll when menu is open
        if (navMenu.classList.contains('active')) {
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = '';
        }
      });
      
      // Close menu when clicking outside
      document.addEventListener('click', function(e) {
        if (navMenu.classList.contains('active') && 
            !navMenu.contains(e.target) && 
            !burgerMenu.contains(e.target)) {
          navMenu.classList.remove('active');
          burgerMenu.classList.remove('active');
          document.body.style.overflow = '';
        }
      });
      
      // Close menu when clicking on a link
      const menuLinks = navMenu.querySelectorAll('a');
      menuLinks.forEach(link => {
        link.addEventListener('click', function() {
          navMenu.classList.remove('active');
          burgerMenu.classList.remove('active');
          document.body.style.overflow = '';
        });
      });
    }
  </script>
</body>
</html>
