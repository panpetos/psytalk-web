<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - psytalk.pro</title>
  <link rel="stylesheet" href="/css/styles.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body style="background-color: #FAFAFA;">
  <!-- Navigation -->
  <nav class="nav" style="background-color: white; border-bottom: 1px solid #F0F0F0;">
    <div class="container">
      <div class="nav-container">
        <a href="/" class="nav-brand" data-testid="link-home" style="font-size: 1.25rem; font-weight: 600; word-spacing: 0; letter-spacing: 0;">
          <span style="color: #1A1A1A;">psy</span><!--
       --><span style="color: #7C3AED; font-style: italic;">talk.pro</span>
        </a>
        <ul class="nav-menu">
          <li><a href="#services" class="nav-link" data-testid="link-services">—É—Å–ª—É–≥–∏</a></li>
          <li><a href="/search.html" class="nav-link" data-testid="link-psychologists">–ø—Å–∏—Ö–æ–ª–æ–≥–∏</a></li>
          <li><a href="#blog" class="nav-link" data-testid="link-blog">–±–ª–æ–≥</a></li>
          <li style="margin-left: 2rem;"><button class="btn btn-outline btn-sm" id="logout-btn" data-testid="button-logout">–í—ã–π—Ç–∏</button></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="section" style="padding: 2rem 0;">
    <div class="container">
      <!-- Header -->
      <div class="mb-6">
        <h1 class="font-bold mb-2" style="font-size: 2rem; color: #1A1A1A;" data-testid="text-page-title">
          –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, <span id="user-name">PAN</span> üëã
        </h1>
      </div>

      <!-- Content Grid -->
      <div class="grid" style="grid-template-columns: 1fr 350px; gap: 2rem; align-items: start;">
        
        <!-- Main Content -->
        <div>
          <!-- Next Session Card - Pink -->
          <div class="card mb-4" style="background: linear-gradient(135deg, #FF9A9E 0%, #FAD0C4 100%); padding: 2rem; color: white;">
            <div class="flex items-center gap-2 mb-2">
              <i data-lucide="alert-circle" style="width: 1.25rem; height: 1.25rem;"></i>
              <span style="font-weight: 600;">–°–ª–µ–¥—É—é—â–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</span>
            </div>
            <div class="mb-3" style="font-size: 1.5rem; font-weight: 700;">
              21 –∏—é–ª—è, –ø—Ç, 19:00
            </div>
            <div style="font-size: 0.875rem; margin-bottom: 0.5rem; opacity: 0.95;">
              Europe/Moscow GMT+3
            </div>
            <div style="margin-bottom: 1rem; opacity: 0.95;">
              –ë—Ä–æ–Ω—å –∞–∫—Ç–∏–≤–Ω–∞ 40 –º–∏–Ω—É—Ç.<br>
              –ß—Ç–æ–±—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–ª–∞—Å—å, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∫–∞—Ä—Ç—É.
            </div>
            <button class="btn w-full" style="background: white; color: #FF9A9E; border: none; font-weight: 600;" data-testid="button-confirm-card">
              –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–∞—Ä—Ç—É
            </button>
          </div>

          <!-- My Psychologist -->
          <div class="card mb-4" style="background-color: white; padding: 1.5rem;">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-semibold" style="font-size: 1.125rem; color: #1A1A1A;">–ú–æ–π –ø—Å–∏—Ö–æ–ª–æ–≥</h3>
              <button style="color: #7C3AED; background: none; border: none; cursor: pointer; font-size: 0.875rem;">
                –ó–∞–º–µ–Ω–∏—Ç—å
              </button>
            </div>

            <div class="flex gap-3" id="psychologist-info">
              <div class="skeleton" style="width: 3rem; height: 3rem; border-radius: 50%;"></div>
              <div class="flex-1">
                <div class="skeleton skeleton-title"></div>
                <div class="skeleton skeleton-text"></div>
              </div>
            </div>

            <button class="btn btn-outline w-full mt-4" data-testid="button-view-profile">
              <i data-lucide="eye" style="width: 1rem; height: 1rem;"></i>
              –ü—Ä–æ—Ñ–∏–ª—å
            </button>
          </div>

          <!-- Support Section -->
          <div class="card" style="background-color: white; padding: 1.5rem;">
            <h3 class="font-semibold mb-3" style="font-size: 1.125rem; color: #1A1A1A;">
              –ü–æ–¥–¥–µ—Ä–∂–∫–∞
            </h3>
            
            <div class="flex gap-3 mb-3">
              <button class="btn flex-1" style="background: linear-gradient(135deg, #7C3AED 0%, #A78BFA 100%); color: white; border: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem;" data-testid="button-telegram">
                <i data-lucide="send" style="width: 1rem; height: 1rem;"></i>
                Telegram
              </button>
              <button class="btn flex-1" style="background: #25D366; color: white; border: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem;" data-testid="button-whatsapp">
                <i data-lucide="message-circle" style="width: 1rem; height: 1rem;"></i>
                WhatsApp
              </button>
            </div>

            <div class="flex items-center gap-2 p-3" style="background: #F5F5F5; border-radius: 0.5rem;">
              <input 
                type="text" 
                value="support@psytalk.pro" 
                readonly 
                style="background: none; border: none; flex: 1; color: #666; font-size: 0.875rem;"
              />
              <button style="background: none; border: none; cursor: pointer; color: #7C3AED;">
                <i data-lucide="copy" style="width: 1rem; height: 1rem;"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <aside>
          <!-- Quick Actions -->
          <div class="card mb-4" style="background-color: white; padding: 1.5rem;">
            <h3 class="font-semibold mb-3" style="font-size: 1.125rem; color: #1A1A1A;">
              –ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
            </h3>
            <p class="text-sm mb-3" style="color: #666;">
              –ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–µ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–æ –æ—á–µ—Ä–µ–¥–∏. –£—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –∏ –æ—Ç–º–µ–Ω—ã —Ç–∞–∫–∂–µ –∫–∞–∫ —É –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –ø–æ –∫–∞—Ä—Ç–µ.
              <button style="color: #7C3AED; background: none; border: none; cursor: pointer; text-decoration: underline; font-size: 0.875rem;">
                –ü–æ–¥—Ä–æ–±–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
              </button>
            </p>
            
            <input 
              type="text" 
              class="form-input mb-3" 
              placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥"
              data-testid="input-promo"
              style="font-size: 0.875rem;"
            />
            
            <button class="btn btn-outline w-full" data-testid="button-apply-promo">
              –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
            </button>
          </div>

          <!-- Payment Methods -->
          <div class="card mb-4" style="background-color: white; padding: 1.5rem;">
            <div class="flex items-center gap-2 mb-3">
              <i data-lucide="credit-card" style="width: 1.125rem; height: 1.125rem; color: #7C3AED;"></i>
              <span style="font-size: 0.875rem; color: #666;">
                –ú—ã –¥–æ–±–∞–≤–∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø–ª–∞—á–∏–≤–∞—Ç—å –≤–∞—à–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∫–∞—Ä—Ç–æ–π Mastercard –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ –±–∞–Ω–∫–∞
              </span>
              <button style="background: none; border: none; color: #666; cursor: pointer;">
                <i data-lucide="x" style="width: 1rem; height: 1rem;"></i>
              </button>
            </div>
            <button style="color: #7C3AED; background: none; border: none; cursor: pointer; text-decoration: underline; font-size: 0.875rem;">
              –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ç—É—Ç ‚Üó
            </button>
          </div>

          <!-- Banner -->
          <div class="card text-center" style="background: linear-gradient(180deg, #7C3AED 0%, #A78BFA 100%); padding: 2rem; color: white; border-radius: 1rem;">
            <div style="font-size: 2.5rem; margin-bottom: 1rem;">
              üëÅÔ∏è
            </div>
            <div class="font-bold mb-2" style="font-size: 1.25rem;">
              –û–ü–û–†–ê
            </div>
            <p style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 1.5rem;">
              –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ —Ç—Ä—É–¥–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞
            </p>
            <button class="btn w-full" style="background: white; color: #7C3AED; border: none; font-weight: 600;">
              –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ
            </button>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <script src="/js/api.js"></script>
  <script src="/js/auth.js"></script>
  <script>
    let currentUser = null;
    let isDemoMode = false;

    // Check if in DEMO mode
    async function checkDemoMode() {
      try {
        const response = await fetch('/api/auth/me');
        
        if (response.status === 503) {
          isDemoMode = true;
          loadDemoData();
        } else if (response.ok) {
          currentUser = await response.json();
          loadUserData();
        } else {
          window.location.href = '/login.html';
        }
      } catch (error) {
        console.error('Error loading user:', error);
        isDemoMode = true;
        loadDemoData();
      }
    }

    // Load demo data
    function loadDemoData() {
      document.getElementById('user-name').textContent = '–ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞';
      
      // Show psychologist
      const psychInfo = {
        name: '–ù–∞–∏–ª—è –†–∞–º–∞–∑–∞–Ω–æ–≤–∞',
        specialization: '–°–µ–º–µ–π–Ω—ã–π –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç'
      };
      
      document.getElementById('psychologist-info').innerHTML = `
        <div class="flex items-center justify-center" style="width: 3rem; height: 3rem; border-radius: 50%; background: #7C3AED; color: white; font-weight: 600; font-size: 1.125rem; flex-shrink: 0;">
          –ù–†
        </div>
        <div class="flex-1">
          <div class="font-semibold" style="color: #1A1A1A;">${psychInfo.name}</div>
          <div class="text-sm" style="color: #666;">${psychInfo.specialization}</div>
        </div>
      `;
    }

    // Load user data
    async function loadUserData() {
      document.getElementById('user-name').textContent = currentUser?.firstName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
      
      // Load psychologist if exists
      // Add your logic here
    }

    // Logout
    document.getElementById('logout-btn')?.addEventListener('click', async () => {
      if (isDemoMode) {
        window.location.href = '/';
        return;
      }
      
      try {
        await fetch('/api/auth/logout', { method: 'POST' });
        window.location.href = '/';
      } catch (error) {
        console.error('Logout error:', error);
        window.location.href = '/';
      }
    });

    // Initialize
    checkDemoMode();
    
    // Initialize Lucide icons
    lucide.createIcons();
  </script>
</body>
</html>
