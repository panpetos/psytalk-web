<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Психологи - psytalk.pro</title>
  <meta name="description" content="Найдите квалифицированного психолога онлайн. Удобные фильтры по специализации, опыту и формату консультации.">
  <link rel="stylesheet" href="/css/styles.css">
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body style="background-color: #FAFAFA;">
  <!-- Navigation -->
  <nav class="nav" style="background-color: white; border-bottom: 1px solid #F0F0F0;">
    <div class="container">
      <div class="nav-container">
        <a href="/" class="nav-brand" data-testid="link-home" style="font-size: 1.25rem; font-weight: 600; word-spacing: 0; letter-spacing: 0;">
          <span style="color: #1A1A1A;">psy</span><!--
       --><span style="color: #7C3AED; font-style: italic;">talk.pro</span>
        </a>
        
        <button class="burger-menu" id="burgerMenu" data-testid="button-burger-menu" onclick="toggleMobileMenu()">
          <span></span>
          <span></span>
          <span></span>
        </button>
        
        <ul class="nav-menu" id="navMenu">
          <li><a href="/#services" class="nav-link" data-testid="link-services">услуги</a></li>
          <li><a href="/search.html" class="nav-link" style="color: #7C3AED; font-weight: 600;" data-testid="link-psychologists">психологи</a></li>
          <li><a href="/blog.html" class="nav-link" data-testid="link-blog">блог</a></li>
          <li><a href="/offers.html" class="nav-link" data-testid="link-offers">спец. предложения</a></li>
          <li style="margin-left: 2rem;"><a href="/login.html" class="btn btn-ghost btn-sm" data-testid="button-login">Войти</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Breadcrumb -->
  <div class="container" style="padding-top: 1.5rem;">
    <div style="color: #999; font-size: 0.875rem;">
      <a href="/" style="color: #999; text-decoration: none;">главная</a>
      <span style="margin: 0 0.5rem;">›</span>
      <span style="color: #1A1A1A;">психологи</span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="section" style="padding: 2rem 0 4rem;">
    <div class="container">
      <!-- Page Header -->
      <div class="mb-6">
        <h1 class="font-bold mb-3" style="font-size: 2rem; color: #1A1A1A;" data-testid="text-page-title">
          Подберите психолога, который вас поймет
        </h1>
        
        <!-- First session badge -->
        <div class="inline-flex items-center gap-2 px-3 py-1" style="background-color: #F3E8FF; border-radius: 2rem; color: #7C3AED; font-size: 0.875rem;">
          <i data-lucide="check-circle" style="width: 0.875rem; height: 0.875rem;"></i>
          <span style="font-weight: 500;">Первая консультация всего 2500 ₽</span>
        </div>
      </div>

      <!-- Layout Grid: Sidebar + Content -->
      <div class="grid" style="grid-template-columns: 300px 1fr; gap: 2rem; align-items: start;">
        
        <!-- Filters Sidebar (Sticky) - Purple theme -->
        <aside class="sticky" style="top: 5rem;" id="filters-sidebar">
          <div class="card" style="background: linear-gradient(180deg, #8B5CF6 0%, #7C3AED 100%); padding: 1.5rem; color: white;">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-semibold" style="font-size: 1.125rem;">Фильтры</h3>
              <button id="close-filters-btn" style="background: none; border: none; color: white; cursor: pointer; display: none;">
                <i data-lucide="x" style="width: 1.25rem; height: 1.25rem;"></i>
              </button>
            </div>

            <!-- Search Input -->
            <div class="form-group">
              <label class="form-label" for="search-input" style="color: rgba(255,255,255,0.9); font-size: 0.875rem;">
                С кем хотите поговорить?
              </label>
              <select id="gender-select" class="form-select" data-testid="select-gender" style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 0.5rem;">
                <option value="">Выберите пол</option>
                <option value="male">Мужчина</option>
                <option value="female">Женщина</option>
                <option value="any">Не важно</option>
              </select>
            </div>

            <!-- Issue Select -->
            <div class="form-group">
              <label class="form-label" for="issue-select" style="color: rgba(255,255,255,0.9); font-size: 0.875rem;">
                О чем хотите поговорить?
              </label>
              <select id="issue-select" class="form-select" data-testid="select-issue" style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 0.5rem;">
                <option value="">Выберите темы</option>
                <option value="relationships">Отношения</option>
                <option value="anxiety">Тревога и стресс</option>
                <option value="self">Самопознание</option>
                <option value="career">Карьера</option>
                <option value="family">Семья</option>
              </select>
            </div>

            <!-- Age Range -->
            <div class="form-group">
              <label class="form-label" for="age-input" style="color: rgba(255,255,255,0.9); font-size: 0.875rem;">
                Возраст психолога
              </label>
              <input 
                type="text" 
                id="age-input" 
                class="form-input" 
                placeholder="24 года"
                data-testid="input-age"
                style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 0.5rem;"
              />
            </div>

            <!-- Apply Button -->
            <button class="btn w-full mt-2" style="background: white; color: #7C3AED; border: none; font-weight: 600;" data-testid="button-apply-filters">
              Применить
            </button>
          </div>
        </aside>

        <!-- Psychologists Grid -->
        <div>
          <!-- Loading State -->
          <div id="loading-state" class="flex flex-column gap-4">
            <div class="card" style="padding: 1.5rem; background-color: white;">
              <div class="flex gap-3">
                <div class="skeleton" style="width: 5rem; height: 5rem; border-radius: 50%;"></div>
                <div class="flex-1">
                  <div class="skeleton skeleton-title"></div>
                  <div class="skeleton skeleton-text"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- No Results State -->
          <div id="no-results" class="card text-center" style="padding: 3rem; background-color: white; display: none;">
            <i data-lucide="search-x" style="width: 3rem; height: 3rem; margin: 0 auto 1rem; color: #999;"></i>
            <h3 class="text-lg font-semibold mb-2" style="color: #1A1A1A;">Психологи не найдены</h3>
            <p style="color: #666;">Попробуйте изменить параметры поиска</p>
            <button class="btn btn-outline mt-4" onclick="location.reload()" data-testid="button-reset-search">
              Сбросить поиск
            </button>
          </div>

          <!-- Psychologists List -->
          <div id="psychologists-list" class="flex flex-column gap-4" style="display: none;">
            <!-- Cards will be inserted here by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Filters Toggle Button -->
  <button class="mobile-filters-toggle" id="mobile-filters-btn" data-testid="button-mobile-filters" style="display: none;">
    <i data-lucide="sliders-horizontal" style="width: 1.5rem; height: 1.5rem;"></i>
  </button>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="mobile-overlay"></div>

  <script src="/js/api.js"></script>
  <script>
    // Mobile filters toggle
    const mobileFiltersBtn = document.getElementById('mobile-filters-btn');
    const closeFiltersBtn = document.getElementById('close-filters-btn');
    const filtersSidebar = document.getElementById('filters-sidebar');
    const mobileOverlay = document.getElementById('mobile-overlay');

    function toggleMobileFilters() {
      filtersSidebar.classList.toggle('active');
      mobileOverlay.classList.toggle('active');
    }

    // Show close button on mobile
    if (window.innerWidth <= 768) {
      if (closeFiltersBtn) closeFiltersBtn.style.display = 'block';
    }

    window.addEventListener('resize', () => {
      if (window.innerWidth <= 768) {
        if (closeFiltersBtn) closeFiltersBtn.style.display = 'block';
      } else {
        if (closeFiltersBtn) closeFiltersBtn.style.display = 'none';
      }
    });

    mobileFiltersBtn?.addEventListener('click', toggleMobileFilters);
    closeFiltersBtn?.addEventListener('click', toggleMobileFilters);
    mobileOverlay?.addEventListener('click', toggleMobileFilters);
  </script>
  <script>
    let allPsychologists = [];
    let filteredPsychologists = [];
    let isDemoMode = false;

    // Check if in DEMO mode
    async function checkDemoMode() {
      try {
        const response = await fetch('/api/psychologists/search');
        
        if (response.status === 503) {
          isDemoMode = true;
          loadDemoData();
        } else if (response.ok) {
          const data = await response.json();
          allPsychologists = data;
          filteredPsychologists = data;
          renderPsychologists();
        }
      } catch (error) {
        console.error('Error loading psychologists:', error);
        isDemoMode = true;
        loadDemoData();
      }
    }

    // Load demo data
    function loadDemoData() {
      allPsychologists = [
        {
          id: 1,
          user: { firstName: 'Елена', lastName: 'Викторовна' },
          specialization: 'Когнитивно-поведенческая терапия',
          description: 'Психолог, семейный психотерапевт. Ко мне обращаются люди, переживающие стрессы, травмы и их последствия, депрессивные состояния, возрастные кризисы и иные кризисные состояния.',
          experience: 5,
          price: 2500,
          rating: 4.8,
          totalReviews: 127,
          formats: ['video', 'audio', 'chat'],
          nextSession: 'Завтра, 20 июля'
        },
        {
          id: 2,
          user: { firstName: 'Анна', lastName: 'Петрова' },
          specialization: 'Семейная терапия',
          description: 'Специалист по семейным отношениям и детской психологии. Помогаю найти гармонию в отношениях и справиться с кризисами.',
          experience: 8,
          price: 3000,
          rating: 4.9,
          totalReviews: 203,
          formats: ['video', 'audio'],
          nextSession: '23.10.2025 в 14:00'
        },
        {
          id: 3,
          user: { firstName: 'Дмитрий', lastName: 'Соколов' },
          specialization: 'Психоанализ',
          description: 'Работаю с глубинными переживаниями, тревогой, депрессией. Помогаю понять себя и найти внутренние ресурсы.',
          experience: 12,
          price: 4000,
          rating: 4.7,
          totalReviews: 89,
          formats: ['video'],
          nextSession: '24.10.2025 в 10:00'
        }
      ];
      filteredPsychologists = allPsychologists;
      renderPsychologists();
    }

    // Render psychologist card
    function renderPsychologistCard(psych) {
      const rating = parseFloat(psych.rating) || 0;
      const formatIcons = { video: 'video', audio: 'phone', chat: 'message-square' };
      
      const formatBadges = (psych.formats || []).map(format => 
        `<span class="badge" style="background: #F3E8FF; color: #7C3AED; border: none; display: inline-flex; align-items: center; gap: 0.25rem; font-size: 0.75rem; padding: 0.25rem 0.5rem;">
          <i data-lucide="${formatIcons[format]}" style="width: 0.75rem; height: 0.75rem;"></i>
          ${format}
        </span>`
      ).join('');

      return `
        <div class="card psychologist-card" data-testid="psychologist-card-${psych.id}" style="background-color: white; padding: 1rem;">
          <div class="psychologist-card-inner">
            <!-- Photo & Main Info -->
            <div class="psychologist-header">
              <img 
                src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=200&h=200&fit=crop" 
                alt="${psych.user.firstName} ${psych.user.lastName}"
                class="psychologist-photo"
              />
              
              <div class="psychologist-info">
                <h3 class="font-semibold" style="color: #1A1A1A; font-size: 1.125rem; margin-bottom: 0.25rem;">
                  ${psych.user.firstName} ${psych.user.lastName}
                </h3>
                <p style="color: #7C3AED; font-size: 0.875rem; margin-bottom: 0.5rem;">
                  ${psych.specialization}
                </p>
                
                <!-- Compact credentials -->
                <div class="psychologist-credentials">
                  <span><i data-lucide="award" style="width: 0.875rem; height: 0.875rem;"></i> ${psych.experience} лет</span>
                  <span><i data-lucide="star" style="width: 0.875rem; height: 0.875rem; fill: #fbbf24; color: #fbbf24;"></i> ${rating}</span>
                </div>
                
                <!-- Format badges -->
                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
                  ${formatBadges}
                </div>
              </div>
            </div>
            
            <!-- Description (mobile hidden) -->
            <p class="psychologist-description">
              ${psych.description.substring(0, 120)}...
            </p>
            
            <!-- Booking Section -->
            <div class="psychologist-booking">
              <div class="psychologist-price">
                <div style="font-size: 1.5rem; font-weight: 700; color: #1A1A1A;">
                  ${parseInt(psych.price).toLocaleString()} ₽
                </div>
                <div style="font-size: 0.75rem; color: #666;">
                  за консультацию
                </div>
              </div>
              
              <button 
                class="btn" 
                style="background: #7C3AED; color: white; border: none; font-weight: 600; padding: 0.75rem 1.5rem; width: 100%;" 
                data-testid="button-select-time-${psych.id}"
                onmouseover="this.style.background='#6D28D9'; this.style.color='white';" 
                onmouseout="this.style.background='#7C3AED'; this.style.color='white';"
              >
                Записаться
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // Render psychologists
    function renderPsychologists() {
      const container = document.getElementById('psychologists-list');
      const loading = document.getElementById('loading-state');
      const noResults = document.getElementById('no-results');

      loading.style.display = 'none';
      
      if (filteredPsychologists.length === 0) {
        container.style.display = 'none';
        noResults.style.display = 'block';
      } else {
        container.style.display = 'flex';
        noResults.style.display = 'none';
        container.innerHTML = filteredPsychologists.map(renderPsychologistCard).join('');
        lucide.createIcons();
      }
    }

    // Apply filters
    function applyFilters() {
      const genderFilter = document.getElementById('gender-select').value.toLowerCase();
      const issueFilter = document.getElementById('issue-select').value.toLowerCase();

      filteredPsychologists = allPsychologists.filter(psych => {
        // Add filter logic here
        return true;
      });

      renderPsychologists();
    }

    // Event listeners
    document.getElementById('gender-select')?.addEventListener('change', applyFilters);
    document.getElementById('issue-select')?.addEventListener('change', applyFilters);
    document.querySelector('[data-testid="button-apply-filters"]')?.addEventListener('click', applyFilters);

    // Initialize
    checkDemoMode();
    
    // Initialize Lucide icons
    lucide.createIcons();
    
    // Mobile menu toggle
    function toggleMobileMenu() {
      const navMenu = document.getElementById('navMenu');
      const burgerMenu = document.getElementById('burgerMenu');
      navMenu.classList.toggle('active');
      burgerMenu.classList.toggle('active');
    }
  </script>
</body>
</html>
