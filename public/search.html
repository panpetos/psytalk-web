<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Психологи - psytalk.pro</title>
  <meta name="description" content="Найдите квалифицированного психолога онлайн. Удобные фильтры по специализации, опыту и формату консультации.">
  <link rel="stylesheet" href="/css/styles.css">
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body style="background-color: #FAFAFA;">
  <!-- Navigation -->
  <nav class="nav" style="background-color: white; border-bottom: 1px solid #F0F0F0;">
    <div class="container">
      <div class="nav-container">
        <a href="/" class="nav-brand" data-testid="link-home" style="font-size: 1.25rem; font-weight: 600;">
          <span style="color: #1A1A1A;">psy</span><span style="color: #7C3AED; font-style: italic;">talk.pro</span>
        </a>
        <ul class="nav-menu">
          <li><a href="#services" class="nav-link" data-testid="link-services">услуги</a></li>
          <li><a href="/search.html" class="nav-link" style="color: #7C3AED; font-weight: 600;" data-testid="link-psychologists">психологи</a></li>
          <li><a href="#blog" class="nav-link" data-testid="link-blog">блог</a></li>
          <li><a href="#offers" class="nav-link" data-testid="link-offers">спец. предложения</a></li>
          <li style="margin-left: 2rem;"><a href="/login.html" class="btn btn-ghost btn-sm" data-testid="button-login">Войти</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Breadcrumb -->
  <div class="container" style="padding-top: 1.5rem;">
    <div style="color: #999; font-size: 0.875rem;">
      <a href="/" style="color: #999; text-decoration: none;">главная</a>
      <span style="margin: 0 0.5rem;">›</span>
      <span style="color: #1A1A1A;">психологи</span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="section" style="padding: 2rem 0 4rem;">
    <div class="container">
      <!-- Page Header -->
      <div class="mb-6">
        <h1 class="font-bold mb-3" style="font-size: 2rem; color: #1A1A1A;" data-testid="text-page-title">
          Подберите психолога, который вас поймет
        </h1>
        
        <!-- First session badge -->
        <div class="inline-flex items-center gap-2 px-3 py-1" style="background-color: #F3E8FF; border-radius: 2rem; color: #7C3AED; font-size: 0.875rem;">
          <i data-lucide="check-circle" style="width: 0.875rem; height: 0.875rem;"></i>
          <span style="font-weight: 500;">Первая консультация всего 2500 ₽</span>
        </div>
      </div>

      <!-- Layout Grid: Sidebar + Content -->
      <div class="grid" style="grid-template-columns: 300px 1fr; gap: 2rem; align-items: start;">
        
        <!-- Filters Sidebar (Sticky) - Purple theme -->
        <aside class="sticky" style="top: 5rem;">
          <div class="card" style="background: linear-gradient(180deg, #8B5CF6 0%, #7C3AED 100%); padding: 1.5rem; color: white;">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-semibold" style="font-size: 1.125rem;">Фильтры</h3>
              <button style="background: none; border: none; color: white; cursor: pointer;">
                <i data-lucide="sliders-horizontal" style="width: 1.25rem; height: 1.25rem;"></i>
              </button>
            </div>

            <!-- Search Input -->
            <div class="form-group">
              <label class="form-label" for="search-input" style="color: rgba(255,255,255,0.9); font-size: 0.875rem;">
                С кем хотите поговорить?
              </label>
              <select id="gender-select" class="form-select" data-testid="select-gender" style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 0.5rem;">
                <option value="">Выберите пол</option>
                <option value="male">Мужчина</option>
                <option value="female">Женщина</option>
                <option value="any">Не важно</option>
              </select>
            </div>

            <!-- Issue Select -->
            <div class="form-group">
              <label class="form-label" for="issue-select" style="color: rgba(255,255,255,0.9); font-size: 0.875rem;">
                О чем хотите поговорить?
              </label>
              <select id="issue-select" class="form-select" data-testid="select-issue" style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 0.5rem;">
                <option value="">Выберите темы</option>
                <option value="relationships">Отношения</option>
                <option value="anxiety">Тревога и стресс</option>
                <option value="self">Самопознание</option>
                <option value="career">Карьера</option>
                <option value="family">Семья</option>
              </select>
            </div>

            <!-- Age Range -->
            <div class="form-group">
              <label class="form-label" for="age-input" style="color: rgba(255,255,255,0.9); font-size: 0.875rem;">
                Возраст психолога
              </label>
              <input 
                type="text" 
                id="age-input" 
                class="form-input" 
                placeholder="24 года"
                data-testid="input-age"
                style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 0.5rem;"
              />
            </div>

            <!-- Apply Button -->
            <button class="btn w-full mt-2" style="background: white; color: #7C3AED; border: none; font-weight: 600;" data-testid="button-apply-filters">
              Применить
            </button>
          </div>
        </aside>

        <!-- Psychologists Grid -->
        <div>
          <!-- Loading State -->
          <div id="loading-state" class="flex flex-column gap-4">
            <div class="card" style="padding: 1.5rem; background-color: white;">
              <div class="flex gap-3">
                <div class="skeleton" style="width: 5rem; height: 5rem; border-radius: 50%;"></div>
                <div class="flex-1">
                  <div class="skeleton skeleton-title"></div>
                  <div class="skeleton skeleton-text"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- No Results State -->
          <div id="no-results" class="card text-center" style="padding: 3rem; background-color: white; display: none;">
            <i data-lucide="search-x" style="width: 3rem; height: 3rem; margin: 0 auto 1rem; color: #999;"></i>
            <h3 class="text-lg font-semibold mb-2" style="color: #1A1A1A;">Психологи не найдены</h3>
            <p style="color: #666;">Попробуйте изменить параметры поиска</p>
            <button class="btn btn-outline mt-4" onclick="location.reload()" data-testid="button-reset-search">
              Сбросить поиск
            </button>
          </div>

          <!-- Psychologists List -->
          <div id="psychologists-list" class="flex flex-column gap-4" style="display: none;">
            <!-- Cards will be inserted here by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/api.js"></script>
  <script>
    let allPsychologists = [];
    let filteredPsychologists = [];
    let isDemoMode = false;

    // Check if in DEMO mode
    async function checkDemoMode() {
      try {
        const response = await fetch('/api/psychologists/search');
        
        if (response.status === 503) {
          isDemoMode = true;
          loadDemoData();
        } else if (response.ok) {
          const data = await response.json();
          allPsychologists = data;
          filteredPsychologists = data;
          renderPsychologists();
        }
      } catch (error) {
        console.error('Error loading psychologists:', error);
        isDemoMode = true;
        loadDemoData();
      }
    }

    // Load demo data
    function loadDemoData() {
      allPsychologists = [
        {
          id: 1,
          user: { firstName: 'Елена', lastName: 'Викторовна' },
          specialization: 'Когнитивно-поведенческая терапия',
          description: 'Психолог, семейный психотерапевт. Ко мне обращаются люди, переживающие стрессы, травмы и их последствия, депрессивные состояния, возрастные кризисы и иные кризисные состояния.',
          experience: 5,
          price: 2500,
          rating: 4.8,
          totalReviews: 127,
          formats: ['video', 'audio', 'chat'],
          nextSession: 'Завтра, 20 июля'
        },
        {
          id: 2,
          user: { firstName: 'Анна', lastName: 'Петрова' },
          specialization: 'Семейная терапия',
          description: 'Специалист по семейным отношениям и детской психологии. Помогаю найти гармонию в отношениях и справиться с кризисами.',
          experience: 8,
          price: 3000,
          rating: 4.9,
          totalReviews: 203,
          formats: ['video', 'audio'],
          nextSession: '23.10.2025 в 14:00'
        },
        {
          id: 3,
          user: { firstName: 'Дмитрий', lastName: 'Соколов' },
          specialization: 'Психоанализ',
          description: 'Работаю с глубинными переживаниями, тревогой, депрессией. Помогаю понять себя и найти внутренние ресурсы.',
          experience: 12,
          price: 4000,
          rating: 4.7,
          totalReviews: 89,
          formats: ['video'],
          nextSession: '24.10.2025 в 10:00'
        }
      ];
      filteredPsychologists = allPsychologists;
      renderPsychologists();
    }

    // Render psychologist card
    function renderPsychologistCard(psych) {
      const initials = `${psych.user.firstName[0]}${psych.user.lastName[0]}`.toUpperCase();
      const rating = parseFloat(psych.rating) || 0;
      const fullStars = Math.floor(rating);
      const formatIcons = { video: 'video', audio: 'phone', chat: 'message-square' };
      
      const formatBadges = (psych.formats || []).map(format => 
        `<span class="badge" style="background: #F3E8FF; color: #7C3AED; border: none; display: inline-flex; align-items: center; gap: 0.25rem; font-size: 0.75rem; padding: 0.25rem 0.5rem;">
          <i data-lucide="${formatIcons[format]}" style="width: 0.75rem; height: 0.75rem;"></i>
          ${format}
        </span>`
      ).join('');

      const stars = Array(5).fill(0).map((_, i) => 
        `<i data-lucide="star" style="width: 1rem; height: 1rem; ${i < fullStars ? 'fill: #fbbf24; color: #fbbf24;' : 'color: #d1d5db;'}"></i>`
      ).join('');

      return `
        <div class="card" data-testid="psychologist-card-${psych.id}" style="background-color: white;">
          <div style="padding: 1.5rem;">
            <div class="flex gap-4">
              <!-- Photo -->
              <img 
                src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=200&h=200&fit=crop" 
                alt="${psych.user.firstName} ${psych.user.lastName}"
                style="width: 8rem; height: 8rem; border-radius: 0.5rem; object-fit: cover; flex-shrink: 0;"
              />
              
              <!-- Info -->
              <div class="flex-1" style="min-width: 0;">
                <h3 class="font-semibold mb-1" style="color: #1A1A1A; font-size: 1.25rem;">
                  ${psych.user.firstName} ${psych.user.lastName}
                </h3>
                <p class="text-sm mb-2" style="color: #7C3AED;">
                  ${psych.specialization}
                </p>
                
                <!-- Credentials -->
                <div class="flex items-center gap-4 mb-3" style="font-size: 0.875rem; color: #666;">
                  <div class="flex items-center gap-1">
                    <i data-lucide="award" style="width: 1rem; height: 1rem;"></i>
                    <span>${psych.experience} лет опыта</span>
                  </div>
                  <div class="flex items-center gap-1">
                    <i data-lucide="graduation-cap" style="width: 1rem; height: 1rem;"></i>
                    <span>2 диплома психолога</span>
                  </div>
                  <div class="flex items-center gap-1">
                    <i data-lucide="book-open" style="width: 1rem; height: 1rem;"></i>
                    <span>3 профильных курса</span>
                  </div>
                </div>
                
                <!-- Tags -->
                <div class="mb-3">
                  <span class="badge badge-secondary" style="font-size: 0.75rem; margin-right: 0.5rem;">психоаналитическая терапия</span>
                  <span class="badge badge-secondary" style="font-size: 0.75rem; margin-right: 0.5rem;">кризисное консультирование</span>
                </div>

                <!-- Format Badges -->
                <div class="flex items-center gap-3 mb-3">
                  <span style="font-size: 0.875rem; color: #666;">Формат работы:</span>
                  <div class="flex gap-2">
                    ${formatBadges}
                  </div>
                </div>
                
                <!-- Description -->
                <p class="text-sm mb-4" style="color: #666; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                  ${psych.description}
                </p>
                
                <button class="text-sm" style="color: #7C3AED; background: none; border: none; cursor: pointer; text-decoration: underline;">
                  Подробнее
                </button>
              </div>

              <!-- Booking Section -->
              <div class="flex flex-column" style="width: 200px; flex-shrink: 0; align-items: center;">
                <div class="card text-center mb-3" style="background: #7C3AED; color: white; padding: 1rem; width: 100%; border-radius: 0.75rem;">
                  <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">
                    ${psych.nextSession}
                  </div>
                  <div style="font-size: 1.5rem; font-weight: 700;">
                    12:00
                  </div>
                </div>
                
                <button class="btn w-full mb-2" style="background: #7C3AED; color: white; border: none; font-weight: 600; white-space: nowrap;" data-testid="button-select-time-${psych.id}">
                  Выбрать другое время
                </button>
                
                <div class="text-center">
                  <div class="font-semibold mb-1" style="font-size: 1.25rem; color: #1A1A1A;">
                    ${parseInt(psych.price).toLocaleString()} ₽
                  </div>
                  <div style="font-size: 0.75rem; color: #666;">
                    /за 50 минут консультации
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Render psychologists
    function renderPsychologists() {
      const container = document.getElementById('psychologists-list');
      const loading = document.getElementById('loading-state');
      const noResults = document.getElementById('no-results');

      loading.style.display = 'none';
      
      if (filteredPsychologists.length === 0) {
        container.style.display = 'none';
        noResults.style.display = 'block';
      } else {
        container.style.display = 'flex';
        noResults.style.display = 'none';
        container.innerHTML = filteredPsychologists.map(renderPsychologistCard).join('');
        lucide.createIcons();
      }
    }

    // Apply filters
    function applyFilters() {
      const genderFilter = document.getElementById('gender-select').value.toLowerCase();
      const issueFilter = document.getElementById('issue-select').value.toLowerCase();

      filteredPsychologists = allPsychologists.filter(psych => {
        // Add filter logic here
        return true;
      });

      renderPsychologists();
    }

    // Event listeners
    document.getElementById('gender-select')?.addEventListener('change', applyFilters);
    document.getElementById('issue-select')?.addEventListener('change', applyFilters);
    document.querySelector('[data-testid="button-apply-filters"]')?.addEventListener('click', applyFilters);

    // Initialize
    checkDemoMode();
    
    // Initialize Lucide icons
    lucide.createIcons();
  </script>
</body>
</html>
